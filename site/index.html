<!DOCTYPE html>
<html>
<head>
  <title>Uken Games Land Purchase System</title>
  <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
  <script src="jsrender.js" type="text/javascript"></script>
  <script src="format.js" type="text/javascript"></script>
  <link href="main.css" rel="stylesheet" type="text/css">
</head>
<body>
  <script id="gameTemplate" type="text/x-jquery-tmpl">
    <div class="game-summary">
      <div class="field">Income:</div>
      <div class="data" id="income" onClick="this.contentEditable='true';">{{format income}}</div>
      <div class="field">Upkeep:</div>
      <div class="data" onClick="this.contentEditable='true';">{{format upkeep}}</div>
      <div class="field">Balance:</div>
      <div class="data" onClick="this.contentEditable='true';">{{format balance}}</div>
      <div class="field">Wallet:</div>
      <div class="data" id="wallet" onClick="this.contentEditable='true';">{{format wallet}}</div>
    </div>
  </script>

  <div id="title">
    Uken Games Land Purchase System
  </div>

  <div id="content">
    <div id="gameList"></div>
  </div>

  <div class="log"></div>
  
  <script type="text/javascript">

    var url = '/games/';
    var request = new XMLHttpRequest();  

    request.open('GET', url, true);  
    request.setRequestHeader("accept", "application/json")

    request.onreadystatechange = function (aEvt) {  
      if (request.readyState == 4) {  
         if (request.status == 200) {
           var data = JSON.parse(request.responseText);

           $.views.registerTags({
		format: CurrencyFormatted
	   });

           $( "#gameList" ).html(
             $( "#gameTemplate" ).render( data )
           );
	 }
         else {
           console.log('Error', request.statusText);  
         }
      }  
    };  
    request.send(null);  
  </script>
  <script type="text/javascript">
    $("div.log").ajaxError(function(e, xhr, settings, exception) {
      $(this).text( 'error in: ' + settings.url + '  error:' + xhr.responseText );
    });
    alert('outside');
    $( ".data" ).focusout(function() {
      alert('inside');
      $.post( "http://localhost:4041/tasks/", 
              '{ name: "setWallet", data: {wallet: 1234} }',
              {contentType: 'application/json'});
    });

    $(".data").keypress(function(e){ return e.which != 13; });
  </script>
</body>
</html>
