<!DOCTYPE html>
<html>
<head>
  <title>Uken Games Land Purchase System</title>
  <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
  <script src="jsrender.js" type="text/javascript"></script>
  <script type="text/javascript">
    function CurrencyFormatted(amount)
    {
      var f = parseFloat(amount);
      if(isNaN(f)) { return '$0'; }
      var s = new String(f);
      var temps = "";
      for (var i = s.length; i > 0; i -= 3)
      {
         temps = s.slice(Math.max(i-3, 0), i) + ',' + temps
      }

      return '$' + temps.slice(0, -1);
    }
  </script>
  <link href="main.css" rel="stylesheet" type="text/css">
</head>
<body>
  <script id="gameTemplate" type="text/x-jquery-tmpl">
    <div class="game-summary">
      <div class="income">Income: {{format income}}</div>
      <div class="income">Upkeep: {{format upkeep}}</div>
      <div class="income">Balance: {{format balance}}</div>
      <div class="income">Wallet: {{format wallet}}</div>
    </div>
  </script>

  <div id="title">
    Uken Games Land Purchase System
  </div>

  <div id="content">
    <div id="gameList"></div>
  </div>
  
  <script type="text/javascript">

    var url = '/finances/';

    var request = new XMLHttpRequest();  
    request.open('GET', url, true);  
    request.setRequestHeader("accept", "application/json")
    request.onreadystatechange = function (aEvt) {  
      if (request.readyState == 4) {  
         if (request.status == 200) {
           var finances = JSON.parse(request.responseText);

           $.views.registerTags({
		format: CurrencyFormatted
	   });

           $( "#gameList" ).html(
             $( "#gameTemplate" ).render( finances )
           );
	 }
         else {
           console.log('Error', request.statusText);  
         }
      }  
    };  
    request.send(null);  

  </script>
</body>
</html>
